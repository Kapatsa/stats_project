---
title: "Развитие стран мира и экономика — анализ данных"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Команда

1. Капаца Дейвид

2. Анна Компанченко

3. Григорий Макаров

### Введение

Данный отчёт представляет из себя результат работы по анализу данных датасета `GrowthDJ`, который доступен по следующей  [ссылке](https://vincentarelbundock.github.io/Rdatasets/articles/data.html).

Сразу же запишем этот датасет в датафрейм `df` и покажем начало таблицы:
```{r}
df <- read.csv("GrowthDJ.csv")
head(df)
```

#### Кoрoтко о данных

Это данные от 1992 года, в качестве индивидов выступают государства (121), в качестве признаков — различные социоэкономические показатели (10). 

1. `oil`
factor. Is the country an oil-producing country?

2. `inter`
factor. Does the country have better quality data?

3. `oecd`
factor. Is the country a member of the OECD? (Организация экономического сотрудничества и развития)

4. `gdp60`
Per capita GDP in 1960.

5. `gdp85`
Per capita GDP in 1985.

6. `gdpgrowth`
Average growth rate of per capita GDP from 1960 to 1985 (in percent).

7. `popgrowth`
Average growth rate of working-age population 1960 to 1985 (in percent).

8. `invest`
Average ratio of investment (including Government Investment) to GDP from 1960 to 1985 (in percent).

9. `school`
Average fraction of working-age population enrolled in secondary school from 1960 to 1985 (in percent).

10. `literacy60`
Fraction of the population over 15 years old that is able to read and write in 1960 (in percent).

Так как датасет состоит во многом из экономических данных, наверняка появится желание прологарифмировать данные, но это потом.

## Первичный анализ данных

### Описательная статистика

```{r}
summary(df)
```

### Виды признаков

Таблица внизу показывает, какую моду имеют наши количественные признаки. Отсюда можно сделать вывод о том, являются они непрерывными или нет.

```{r}
library(dplyr)
summarize(df, across(gdp60:literacy60, function(x) max(table(x))))
```

1. `oil` качественный

2. `inter` качественный

3. `oecd` качественный

4. `gdp60` количественный почти непрерывный

5. `gdp85` количественный почти непрерывный

6. `gdpgrowth` количественный дискретный

7. `popgrowth` количественный дискретный

8. `invest` количественный дискретный

9. `school` количественный дискретный

10. `literacy60` количественный дискретный


## Matrix plot

Сразу же построим matrix plot для того, чтобы увидеть особенности в наших данных.

```{r}
panel.hist <- function(x, ...)
{
    usr <- par("usr"); on.exit(par(usr))
    par(usr = c(usr[1:2], 0, 1.5) )
    h <- hist(x, plot = FALSE)
    breaks <- h$breaks; nB <- length(breaks)
    y <- h$counts; y <- y/max(y)
    rect(breaks[-nB], 0, breaks[-1], y, col = "orange", ...)
}

pairs(~ gdp60 + gdp85 + gdpgrowth + invest + school, data = df, diag.panel = panel.hist, pch = 19,  cex = 0.5)
```

Хорошо видно по гистограммам, что для дальнейшего анализа надо логарифмировать показатели ВВП. Сделаем именно это:

```{r}
pairs(~ log(gdp60) + log(gdp85) + gdpgrowth + invest + school, data = df, diag.panel = panel.hist, pch = 19,  cex = 0.5)
```

Стало лучше.


### Аутлаеры

Видим очевидный аутлаер по признаку `gdp60`. Его можно заметить и по признаку `gdp60`.

```{r}
which.max(df$gdp60)
which.max(df$gdp85)
```

Оказывается, что такой высокий показатель ВВП на душу населения наблюдался в Кувейте, одном из крупнейших экспортёров нефти.

### Неоднородности

#### Нефть

Мы предположили, что страны, которые добывают нефть, должны в целом положительным образом отличаться от других.

```{r}
my_cols <- c("light blue", "orange")
pairs(~ log(gdp60) + log(gdp85) + gdpgrowth + invest + school, data = df, col = my_cols[df$oil], pch = 19,  cex = 0.5, oma=c(3,3,6,8))
par(xpd = TRUE)
legend("bottomright", legend = c("no oil", "oil"), col = my_cols, pch = 19,  cex = 0.5)
title("Matrix Plot (group by oil)")
```

Однако, при делении данных по фактору "нефть", сложно установить неоднородность данных. Можно предположить, что наличие/отсутствие нефти не влияет на данные экономические показатели. 

#### Участие в ОЭСР

ОЭСР — это крупная международная организация, которая была создана для поддержки плана Маршалла для восстановления Западной Европы после Второй Мировой, поэтому ожидаем разницу в соответствующих условных распределениях.

```{r}
pairs(~ log(gdp60) + log(gdp85) + gdpgrowth + invest + school, data = df, col = my_cols[df$oecd], pch = 19,  cex = 0.5, oma=c(3,3,6,10.5))
par(xpd = TRUE)
legend("bottomright", legend = c("non-member", "member"), col = my_cols, pch = 19,  cex = 0.5)
title("Matrix Plot (group by OECD membership)")
```

Данную неоднородность можно объяснить тем, что в ОЭСР входят развитые европейские страны из-за чего мы можем наблюдать достаточно высокие показатели ВВП в этой группе.

#### Качество данных

```{r}
pairs(~ log(gdp60) + log(gdp85) + gdpgrowth + invest + school, data = df, col = my_cols[df$inter], pch = 19,  cex = 0.5, oma=c(3,3,6,10))
par(xpd = TRUE)
legend("bottomright", legend = c("poor quality", "good quality"), col = my_cols, pch = 19,  cex = 0.5)
title("Matrix Plot (group by quality of data)")
```

По данному matrix plot можно сделать предположение, что наблюдается однородность данных по признаку "inter", что в свою очередь означает, что в общем все данные репрезентативные. (Аутлаер, как можно заметить, входит в "poor quality").

```{r}
library(psych)
df_for_cor <- data.frame( "ln_gdp60"     = log(df$gdp60), 
                          "ln_gdp85"     = log(df$gdp85), 
                          "gdpgrowth" = df$gdpgrowth,
                          "invest"    = df$invest,
                          "school"    = df$school)

ind_60 <- which.max(df_for_cor$ln_gdp60)
ind_85 <- which.max(df_for_cor$ln_gdp85)
df_for_cor$ln_gdp60[ind_60] <- NA
df_for_cor$ln_gdp85[ind_85] <- NA

pairs.panels(df_for_cor, 
             method = "pearson", 
             hist.col = "orange",
             density = TRUE,
             ellipses = FALSE,
             lm = TRUE,
             stars = TRUE
             )
```

1. Между ВВП на душу населения в 1960 и средним отношением инвестиций наблюдается корреляция с коэфицентом 0.58.
Между ВВП на душу населения в 1985 и средним отношением инвестиций наблюдается корреляция с коэфицентом 0.71.
Чем больше инвестируют в страну, тем больше она производит и тем больше ВВП.

2. Так же показатели ВВП хорошо коррелируют со средней долей населения трудоспособного возраста, посещавшего среднюю школу.

### О виде распределений и о сравнении распределений

1. Выберите в данных категоризующую переменную. По ней выборка разбивается на подвыборки (например, случай, когда вы увидели неоднородность при первичном анализе, но необязательно).

Возьмём членство в ОЭСР как категоризующую переменную.

2. Сначала имеет смысл посмотреть на сравнение распределений в группах с помощью ящиков с усами (box plot). С помощью ящиков с усами там, где групп больше двух, можно выбрать две из них, которые интересно сравнить с помощью критериев.

```{r}
par(mfrow=c(1,2))

boxplot(log(gdp60)~oecd,
data=df,
main="GDP in 1960",
xlab="membership in oecd",
ylab="log GDP (per capita)",
ylim = c(6, 11.5),
col="orange",
border="brown"
)

boxplot(log(gdp85)~oecd,
data=df,
main="GDP in 1985",
xlab="membership in oecd",
ylab="log GDP (per capita)",
ylim = c(6, 11.5),
col="orange",
border="brown"
)
```
```{r}
boxplot(school~oecd,
data=df,
main="Secondary school enrollment",
xlab="membership in oecd",
ylab="fraction",
col="orange",
border="brown"
)
```

3. Проверьте, близко ли распределение выбранных признаков к нормальному. Можно использовать различные критерии для проверки этой гипотезы, можно рисовать normal probability plot.

```{r}
par(mfrow=c(2,2))
hist(log(df$gdp60[which(df$oecd=="yes")]), col= "light green", main = "1960", xlab = "log GDP (per capita)")
hist(log(df$gdp85)[which(df$oecd=="yes")], col= "light green", main = "1985", xlab = "log GDP (per capita)")
title("oecd members", line = -1, outer = TRUE)
hist(log(df$gdp60[which(df$oecd=="no")]), col= "orange", main = "1960", xlab = "log GDP (per capita)")
hist(log(df$gdp85)[which(df$oecd=="no")], col= "orange", main = "1985", xlab = "log GDP (per capita)")
title("non-oecd members", line = -14, outer = TRUE)
shapiro.test(log(df$gdp60)[which(df$oecd=="yes")])
shapiro.test(log(df$gdp85)[which(df$oecd=="yes")])
shapiro.test(log(df$gdp60)[which(df$oecd=="no")])
shapiro.test(log(df$gdp85)[which(df$oecd=="no")])
```

```{r}
par(mfrow=c(1,2))
hist((df$gdpgrowth)[which(df$oecd=="no")], col= "orange", main = "not in oecd", xlab = "GDP growth")
hist((df$gdpgrowth)[which(df$oecd=="yes")], col= "light green", main = "oecd members", xlab = "GDP growth")
shapiro.test((df$gdpgrowth)[which(df$oecd=="no")])
shapiro.test((df$gdpgrowth)[which(df$oecd=="yes")])
```


4. Сравните группы между собой. Можно сравнить по разным критериям, например, критерий t-test, который умеет обнаруживать разницу в среднем. Непараметрический аналог, с помощью которого можно обнаруживать сдвиг - критерий Манна-Уитни/Вилкоксона.

5. Но распределения могут отличаться не только сдвигом. Рассмотрите критерий Колмогорова-Смирнова, который может обнаружить, если распределения отличаются формой.

6. Если есть признаки, которые характеризуют одно и то же (например, время, которое человек тратит на сон, и время на работу), то аналогично производится сравнение по t-критерию и по непараметрическим критериям, они называются парными.

